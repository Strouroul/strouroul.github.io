<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Leads</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" type="text/css" href="./swal_toast.css"/>


    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" id="bootstrap_min_css">
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" id="bootstrap_min_js"></script>
 -->
    <link rel='stylesheet' href='//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css'>


    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css'>

    <script src="https://strouroul.github.io/portifolio/porti2/js/iconify.min.js"></script>


    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <!--  <script src="/LAYOUT/call_center/js/vanilla-toast.js"></script>-->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <!-- <style>
         * {
             box-sizing: border-box;
         }

         input[type=text], select, textarea {
             width: 100%;
             padding: 12px;
             border: 1px solid #ccc;
             border-radius: 4px;
             resize: vertical;
         }

         label {
             padding: 12px 12px 12px 0;
             display: inline-block;
         }

         input[type=submit] {
             background-color: #04AA6D;
             color: white;
             padding: 12px 20px;
             border: none;
             border-radius: 4px;
             cursor: pointer;
             float: right;
         }

         input[type=submit]:hover {
             background-color: #45a049;
         }

         .container {
             border-radius: 5px;
             background-color: #f2f2f2;
             padding: 20px;
         }

         .col-25 {
             float: left;
             width: 25%;
             margin-top: 6px;
         }

         .col-75 {
             float: left;
             width: 75%;
             margin-top: 6px;
         }

         /* Clear floats after the columns */
         .row:after {
             content: "";
             display: table;
             clear: both;
         }

         /* Responsive layout - when the screen is less than 600px wide, make the two columns stack on top of each other instead of next to each other */
         @media screen and (max-width: 600px) {
             .col-25, .col-75, input[type=submit] {
                 width: 100%;
                 margin-top: 0;
             }
         }
     </style>-->

    <!--
        <style>
            /*
            body {
                padding : 10px ;

            }*/

            #exTab1 .tab-content {
                color : white;
                background-color: #428bca;
                padding : 0px 5px;
            }

            #exTab2 h3 {
                color : white;
                background-color: #428bca;
                padding : 5px 15px;
            }

            /* remove border radius for the tab */

            #exTab1 .nav-pills > li > a {
                border-radius: 0;
            }

            /* change border radius for the tab , apply corners on top*/

            #exTab3 .nav-pills > li > a {
                border-radius: 4px 4px 0 0 ;
            }

            #exTab3 .tab-content {
                color : white;
                background-color: #428bca;
                padding : 5px 15px;
            }




            html, body, #exTab1, .tab-content, .tab-pane {
                height: 100%;
                width: 100%;
                margin: 0;
                padding: 0;
                overflow-x: scroll;
                overflow-y: scroll;
            }

            #3a {
                height: 100vh; /* Full viewport height */
                width: 100%;
                overflow-x: scroll;
                overflow-y: scroll;
            }

            #3a iframe {
                height: 100%;
                width: 100%;
                border: none;
                overflow-x: scroll;
                overflow-y: scroll;
            }

        </style>-->


    <style>

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow:scroll;
        }

        #exTab1 {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        .nav-pills {
            margin-bottom: 0;
        }

        .tab-content {
            height: calc(100% - 40px); /* Adjust based on nav height */
            width: 100%;
            padding: 0;
            overflow: scroll;
        }

        .tab-pane {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }



        #3a   {
            height: 100%;
            width: 100%;
            border: none;
            /* overflow: auto; /* Makes iframe scrollable */
            overflow: scroll;
            overflow-x: scroll !important;
            display: block;

        }

    </style>




    <style>
        /*
        html,body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        *,*:after, *:before{
            margin: inherit;
            padding: inherit;
            box-sizing: inherit;
        }

        body {
            display: flex;
            justify-content: center;
        }
*/
        #result_container {
            width: 600px;
            padding: 30px;

        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table thead tr,
        table tfoot tr{
            background: rgba(0,0,0,0.2);
        }

        table tbody tr {
            background: rgba(0,0,0,0.08);
        }

        table tbody tr:hover{
            background: rgba(0,0,0,0.05);
        }

        table tr>th {
            text-align: left;
        }

        table tr>th, tr>td {
            border: 1px solid rgba(0,0,0,0.2);
            padding: 10px 15px;
            cursor:pointer;

        }

        #pagination {
            display: block;
            padding:10px;
            text-align:center;
        }

        #pagination > a {
            display: inline-block;
            text-decoration: none;
            padding: 10px;
            border: 1px solid rgba(0,0,0,0.2);
            border-right: 0;
            background: rgba(0,0,0,0.08);
            color: #000;
            font-weight: 600;
        }

        #pagination > a:last-child {
            border-right: 1px solid rgba(0,0,0,0.2);
        }

        #pagination > a:hover {
            background: rgba(0,0,0,0.03);
            color: #FB3C00;
        }


         #select_perPage {
            display: inline-block !important;
            visibility: visible !important;
            opacity: 1 !important;
             width:100px;
        }
    </style>
</head>
<body>
<!--
<div class="container">
    <h1>CRM / Script  </h1>
</div>-->

<div  style="overflow-y: scroll;">
    <div id="exTab1" class="container" style="overflow-y: scroll;">
        <ul  class="nav nav-pills">
            <li class="active">
                <a  href="#divParams" data-toggle="tab">Search Leads</a>
            </li>
            <li><a href="./add_lead.html" >Add Lead</a>
            </li>

        </ul>

        <div class="tab-content clearfix" >

            <div class="tab-pane active" id="divParams" style="overflow-y: scroll;">


                <div style="display: flex; align-items: center; gap: 15px;">
                    <label for="lead_list_id">
                        Lead List ID:
                        <input type="text" id="lead_list_id" value="800" disabled placeholder="Enter the List ID">
                    </label>

                    <button onclick="searchLeads()">Search</button>

                    <div id="dropdownContainer">
                        <label for="select_perPage">Results per page:</label>
                        <select id="select_perPage" onchange="changePerPage(this.value)">
                            <option value="5" selected>5</option>
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                </div>

                <label for="results_count">
                    Results found :   <span id="results_count"></span>
                </label>

                <div id="result_container"
                     style="overflow-y: scroll;overflow-x: scroll; height: 80%; width: 100%;" >
                    <table style="overflow-y: scroll;overflow-x: scroll; height: 80%; width: 100%;" >
                        <thead>
                        <tr>
                            <th>First Name</th><th>Last Name</th><th>Phone</th><th>Alt Phone</th><th>Comments</th><th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                        <tr>
                            <th>First Name</th><th>Last Name</th><th>Phone</th><th>Alt Phone</th><th>Comments</th><th>Actions</th>
                        </tr>
                        </tfoot>
                    </table>
                    <div id="pagination"></div>
                </div>
            </div>

        </div>
    </div>
</div>


<!--

<hr></hr>
<div class="container"><h2>Example tab 2 (using standard nav-tabs)</h2></div>

<div id="exTab2" class="container">
    <ul class="nav nav-tabs">
        <li class="active">
            <a  href="#1" data-toggle="tab">Overview</a>
        </li>
        <li><a href="#2" data-toggle="tab">Without clearfix</a>
        </li>
        <li><a href="#3" data-toggle="tab">Solution</a>
        </li>
    </ul>

    <div class="tab-content ">
        <div class="tab-pane active" id="1">
            <h3>Standard tab panel created on bootstrap using nav-tabs</h3>
        </div>
        <div class="tab-pane" id="2">
            <h3>Notice the gap between the content and tab after applying a background color</h3>
        </div>
        <div class="tab-pane" id="3">
            <h3>add clearfix to tab-content (see the css)</h3>
        </div>
    </div>
</div>

<hr></hr>

<div class="container"><h2>Example 3 </h2></div>
<div id="exTab3" class="container">
    <ul  class="nav nav-pills">
        <li class="active">
            <a  href="#1b" data-toggle="tab">Overview</a>
        </li>
        <li><a href="#2b" data-toggle="tab">Using nav-pills</a>
        </li>
        <li><a href="#3b" data-toggle="tab">Applying clearfix</a>
        </li>
        <li><a href="#4a" data-toggle="tab">Background color</a>
        </li>
    </ul>

    <div class="tab-content clearfix">
        <div class="tab-pane active" id="1b">
            <h3>Same as example 1 but we have now styled the tab's corner</h3>
        </div>
        <div class="tab-pane" id="2b">
            <h3>We use the class nav-pills instead of nav-tabs which automatically creates a background color for the tab</h3>
        </div>
        <div class="tab-pane" id="3b">
            <h3>We applied clearfix to the tab-content to rid of the gap between the tab and the content</h3>
        </div>
        <div class="tab-pane" id="4b">
            <h3>We use css to change the background color of the content to be equal to the tab</h3>
        </div>
    </div>
</div>

-->
<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="./postAjax.js"></script>


<script>

let perPage = 5;

/*
function paginate_leads(dataSet){

    const displayPageNav = perPage => {

        let pagination =``
        const totalItems = dataSet.length
        perPage = perPage ? perPage : 1
        const pages = Math.ceil(totalItems/perPage)

        for(let i = 1; i <= pages; i++) {
            pagination += `<a href="#" onClick="displayItems(${i},${perPage})" >${i}</a>`
        }

        document.getElementById('pagination').innerHTML = pagination

    }

    const displayItems = ( page = 1, perPage = 2 ) => {

        let index, offSet

        if(page == 1 || page <=0)  {
            index = 0
            offSet = perPage
        } else if(page > dataSet.length) {
            index = page - 1
            offSet = dataSet.length
        } else {
            index = page * perPage - perPage
            offSet = index + perPage
        }

        const slicedItems = dataSet.slice(index, offSet)

        const html = slicedItems.map(item =>
            `<tr>
      <td>${item.first_name}</td>
      <td>${item.last_name}</td>
      <td>${item.phone_number}</td>
         <td>${item.alt_phone}</td>
            <td>${item.comments}</td>
    </tr>`)

        document.querySelector('#container tbody').innerHTML = html.join('')

    }


    displayPageNav(perPage)
    displayItems(1, perPage)
}
*/
// Reusable display function
function displayItems(dataSet, page = 1, perPage = 2, rowTemplateFn) {
    let index, offSet;

    if (page <= 1) {
        index = 0;
        offSet = perPage;
    } else if (page > dataSet.length) {
        index = page - 1;
        offSet = dataSet.length;
    } else {
        index = page * perPage - perPage;
        offSet = index + perPage;
    }

    const slicedItems = dataSet.slice(index, offSet);

    const html = slicedItems.map(item => rowTemplateFn(item));

    document.querySelector('#result_container tbody').innerHTML = html.join('');
}

// Pagination setup
function paginate_leads(dataSet, perPage = 2, rowTemplateFn) {
    let pagination = ``;
    const totalItems = dataSet.length;
    const pages = Math.ceil(totalItems / perPage);

    for (let i = 1; i <= pages; i++) {
        pagination += `<a href="javascript:void(0);" onClick="displayItems(window.currentDataSet, ${i}, ${perPage}, window.currentRowTemplateFn)">${i}</a> `;
    }

    document.getElementById('pagination').innerHTML = pagination;

    // Store globally so displayItems can access them
    window.currentDataSet = dataSet;
    window.currentRowTemplateFn = rowTemplateFn;

    // Show first page
    displayItems(dataSet, 1, perPage, rowTemplateFn);


   // document.getElementById('dropdownContainer').innerHTML = `   `;
}





function open_edit_page(item_str) {

   // console.log(`item_str : `,item_str)
    let item = JSON.parse(decodeURIComponent(item_str).replaceAll('+'," ")) || {};
   // const params = new URLSearchParams(item).toString();

    let params="";
    Object.keys(item).forEach((key,index)=>{
        if(index===(Object.keys(item).length-1)){
            params+=`${key}=${item[key]}`
        }
        else{
            params+=`${key}=${item[key]}&`
        }

    })
    console.log(`item : `,item)
    window.open(`index.html?${params}`, '_blank');
}


function searchLeads(){
    let this_lead_update_json={
        lead_list_id:document.getElementById('lead_list_id').value
    };
    postAjax_ASYNC('https://ishopper.info/contact_form/get_leads.pl',
        {param: JSON.stringify(this_lead_update_json)},
        function (data) {


            return new Promise((resolve, reject) => {
                console.log(`Lead Update  : ${data}`);
                let myJSON_new = JSON.parse(data);
                if (myJSON_new != null) {


                    resolve(myJSON_new);

                } else {
                    reject({error:"CANT FIND JSON"})
                }
            })


        })
        .then(my_DATA => {
            if (my_DATA != null) {
                console.log("Lead status from server : " + JSON.stringify(my_DATA));

                if(my_DATA.hasOwnProperty('db')){
                    if(Object.keys(my_DATA.db).length>0|| my_DATA.db.length>0){

                        document.getElementById('results_count').innerText=Object.keys(my_DATA.db).length;
                        // Usage
                        paginate_leads(my_DATA.db, perPage, (item) => `
    <tr   >
        <td>${item.first_name}</td>
        <td>${item.last_name}</td>
        <td>${item.phone_number}</td>
        <td>${item.alt_phone}</td>
        <td>${item.comments}</td>
          <td style="width: 100px;">
           <i class="iconify" data-icon="tabler:edit" style="width:25px;height:25px;" data-toggle="tooltip" data-html="true"
           title="Edit" onclick="open_edit_page('${encodeURIComponent(JSON.stringify(item))}')" ></i>
         <i class="iconify" data-icon="tdesign:delete-filled" style="width:25px;height:25px;" data-toggle="tooltip" data-html="true"
           title="Edit"></i>
         </td>
    </tr>
`);
                    }
                }



            }


        })
        .catch(my_err => {
            console.log(my_err);
        });
}


function changePerPage(newPerPage){
    perPage=newPerPage;
    searchLeads();
}

document.addEventListener( "DOMContentLoaded", function(){
    searchLeads()
} );






</script>
</body>
</html>