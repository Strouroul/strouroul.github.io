<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Games</title>
</head>
<body>
<h1>Games</h1>
<!--
<a href="./games_installed.json">Installed</a>

<BR><BR>
<a href="./games_isos.json">ISOs</a>
-->
<p>Installed Games</p>
<div id="table-installed"></div>
<br><br>

<p>ISO Games</p>
<div id="table-ISOs"></div>

<script>
    // Global array with keys to hide in the table.
    const HIDE_COLOUM = ['path', 'name','INFO'];  // Adjust this array as needed

    // 1. Function to fetch JSON from a URL
    async function fetchJSON(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return await response.json();
        } catch (error) {
            console.error("Failed to fetch JSON:", error);
            return null;
        }
    }

    // 2. Function to create an HTML table from the JSON data
    function createTableFromData(data, keyFieldName = "Name") {
        const table = document.createElement("table");
        table.border = 1;

        const allCols = [
            { key: 'key', header: keyFieldName === "Key" ? "Name" : keyFieldName },
            { key: 'name', header: 'Name' },
            { key: 'size', header: 'Size' },
            { key: 'path', header: 'Path' },
            { key: 'INFO', header: 'INFO' },
            { key: 'IMG', header: 'IMG' }
        ];

        const visibleCols = allCols.filter(col => !HIDE_COLOUM.includes(col.key));

        const headerRow = document.createElement("tr");
        visibleCols.forEach(col => {
            const th = document.createElement("th");
            th.textContent = col.header;
            headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        for (const [key, value] of Object.entries(data)) {
            const row = document.createElement("tr");
            visibleCols.forEach(col => {
                const cell = document.createElement("td");
                if(col.key==="IMG"){

                    //  console.log(`value[col.key] : `,value );
                    if(value.hasOwnProperty('INFO')){
                        if(value.INFO!==null){
                            if(value.INFO.length>0){
                                cell.innerHTML = `<img src='${value["INFO"][0].background_image}' style="width:100px;height:100px;">` ;
                            }
                        }
                        else{

                        }

                    }

                }
                else{
                    cell.textContent = (col.key === 'key') ? key : value[col.key];
                }

                row.appendChild(cell);
            });
            table.appendChild(row);
        }

        return table;
    }

    // 3. Function to render the table and show render time
    async function renderTableFromJSON(url, targetElementId, keyFieldName = "Key") {
        const startTime = performance.now();

        const data = await fetchJSON(url);
        if (!data) return;

        const table = createTableFromData(data, keyFieldName);



        const container = document.getElementById(targetElementId);

        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(2);
        if (container) {
            const timeSpan = document.createElement("span");
            timeSpan.textContent = `Rendered in ${duration} ms`;
            timeSpan.style.display = "block";
            timeSpan.style.marginBottom = "5px";
            container.appendChild(timeSpan);
            container.appendChild(table);
        } else {
            console.warn(`Element with ID "${targetElementId}" not found`);
        }
    }
</script>

<script>
    renderTableFromJSON("./games_installed.json", "table-installed", "Name");
    renderTableFromJSON("./games_isos.json", "table-ISOs", "Name");
</script>


</body>
</html>